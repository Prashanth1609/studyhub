{% extends 'core/base.html' %}
{% load static %}

{% block title %}Sign Up - StudyHub{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-6 col-md-8">
        <div class="text-center mb-4">
            <h1 class="h2 fw-bold text-primary mb-3">
                <i class="fas fa-user-plus me-2"></i>Join StudyHub
            </h1>
            <p class="text-muted">Create your account and start your collaborative learning journey</p>
        </div>

        <div class="card border-0 shadow-lg">
            <div class="card-body p-4 p-md-5">
                <form method="post" id="signupForm" class="needs-validation" novalidate>
                    {% csrf_token %}
                    
                    <!-- Username Field -->
                    <div class="mb-4">
                        <label for="{{ form.username.id_for_label }}" class="form-label fw-semibold">
                            <i class="fas fa-user me-2 text-primary"></i>Username
                        </label>
                        {{ form.username }}
                        {% if form.username.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.username.errors %}
                                    <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                        <div class="form-text">
                            <i class="fas fa-info-circle me-1"></i>Choose a unique username for your profile
                        </div>
                    </div>

                    <!-- Email Field -->
                    <div class="mb-4">
                        <label for="{{ form.email.id_for_label }}" class="form-label fw-semibold">
                            <i class="fas fa-envelope me-2 text-primary"></i>Email Address
                        </label>
                        {{ form.email }}
                        {% if form.email.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.email.errors %}
                                    <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                        <div class="form-text">
                            <i class="fas fa-info-circle me-1"></i>We'll never share your email with anyone else
                        </div>
                    </div>

                    <!-- Education Level Field -->
                    <div class="mb-4">
                        <label for="{{ form.education_level.id_for_label }}" class="form-label fw-semibold">
                            <i class="fas fa-graduation-cap me-2 text-primary"></i>Education Level
                        </label>
                        {{ form.education_level }}
                        {% if form.education_level.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.education_level.errors %}
                                    <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                        <div class="form-text">
                            <i class="fas fa-info-circle me-1"></i>This helps us match you with relevant study sessions
                        </div>
                    </div>

                    <!-- Password Field -->
                    <div class="mb-4">
                        <label for="{{ form.password1.id_for_label }}" class="form-label fw-semibold">
                            <i class="fas fa-lock me-2 text-primary"></i>Password
                        </label>
                        <div class="input-group">
                            {{ form.password1 }}
                            <button class="btn btn-outline-secondary" type="button" id="togglePassword1">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        {% if form.password1.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.password1.errors %}
                                    <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                        <div class="password-strength mt-2" id="passwordStrength">
                            <div class="progress" style="height: 6px;">
                                <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                            </div>
                            <small class="text-muted mt-1 d-block">Password strength: <span id="strengthText">Weak</span></small>
                        </div>
                    </div>

                    <!-- Confirm Password Field -->
                    <div class="mb-4">
                        <label for="{{ form.password2.id_for_label }}" class="form-label fw-semibold">
                            <i class="fas fa-lock me-2 text-primary"></i>Confirm Password
                        </label>
                        <div class="input-group">
                            {{ form.password2 }}
                            <button class="btn btn-outline-secondary" type="button" id="togglePassword2">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        {% if form.password2.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.password2.errors %}
                                    <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                        <div class="password-match mt-2" id="passwordMatch">
                            <i class="fas fa-check-circle text-success me-1" style="display: none;"></i>
                            <i class="fas fa-times-circle text-danger me-1" style="display: none;"></i>
                            <small class="text-muted">Passwords must match</small>
                        </div>
                    </div>

                    <!-- Terms and Conditions -->
                    <div class="mb-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="termsCheck" required>
                            <label class="form-check-label" for="termsCheck">
                                I agree to the <a href="#" class="text-primary">Terms and Conditions</a> and 
                                <a href="#" class="text-primary">Privacy Policy</a>
                            </label>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                            <i class="fas fa-rocket me-2"></i>Create Account
                        </button>
                    </div>
                </form>

                <!-- Login Link -->
                <div class="text-center mt-4">
                    <p class="mb-0">
                        Already have an account? 
                        <a href="{% url 'login' %}" class="text-primary fw-semibold">
                            <i class="fas fa-sign-in-alt me-1"></i>Sign In
                        </a>
                    </p>
                </div>
            </div>
        </div>

        <!-- Benefits Section -->
        <div class="row mt-4 g-3">
            <div class="col-md-4">
                <div class="text-center p-3">
                    <div class="benefit-icon mb-2">
                        <i class="fas fa-users fa-2x text-primary"></i>
                    </div>
                    <h6 class="fw-semibold">Find Study Partners</h6>
                    <small class="text-muted">Connect with students in your field</small>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center p-3">
                    <div class="benefit-icon mb-2">
                        <i class="fas fa-calendar-alt fa-2x text-success"></i>
                    </div>
                    <h6 class="fw-semibold">Flexible Sessions</h6>
                    <small class="text-muted">Study when it works for you</small>
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center p-3">
                    <div class="benefit-icon mb-2">
                        <i class="fas fa-chart-line fa-2x text-warning"></i>
                    </div>
                    <h6 class="fw-semibold">Track Progress</h6>
                    <small class="text-muted">Monitor your learning journey</small>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .benefit-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
        color: white;
        transition: all 0.3s ease;
    }
    
    .benefit-icon:hover {
        transform: scale(1.1);
    }
    
    .password-strength .progress-bar {
        transition: all 0.3s ease;
    }
    
    .form-control:focus, .form-select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.25);
    }
    
    .card {
        border-radius: 16px;
        overflow: hidden;
    }
    
    .btn-lg {
        padding: 12px 24px;
        font-size: 1.1rem;
        font-weight: 600;
    }
    
    .form-control-lg, .form-select-lg {
        padding: 12px 16px;
        font-size: 1rem;
    }
    
    /* Style form fields */
    input[type="text"], input[type="email"], input[type="password"], select, textarea {
        padding: 12px 16px;
        font-size: 1rem;
        border-radius: 12px;
        border: 2px solid var(--border-color);
        transition: all 0.3s ease;
        width: 100%;
    }
    
    input[type="text"]:focus, input[type="email"]:focus, input[type="password"]:focus, select:focus, textarea:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.25);
        transform: translateY(-1px);
        outline: none;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('signupForm');
        const password1 = document.getElementById('{{ form.password1.id_for_label }}');
        const password2 = document.getElementById('{{ form.password2.id_for_label }}');
        const togglePassword1 = document.getElementById('togglePassword1');
        const togglePassword2 = document.getElementById('togglePassword2');
        const passwordStrength = document.getElementById('passwordStrength');
        const passwordMatch = document.getElementById('passwordMatch');
        const submitBtn = document.getElementById('submitBtn');
        const termsCheck = document.getElementById('termsCheck');

        // Toggle password visibility
        function togglePasswordVisibility(inputField, toggleBtn) {
            if (inputField.type === 'password') {
                inputField.type = 'text';
                toggleBtn.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                inputField.type = 'password';
                toggleBtn.innerHTML = '<i class="fas fa-eye"></i>';
            }
        }

        togglePassword1.addEventListener('click', () => togglePasswordVisibility(password1, togglePassword1));
        togglePassword2.addEventListener('click', () => togglePasswordVisibility(password2, togglePassword2));

        // Password strength checker
        function checkPasswordStrength(password) {
            let strength = 0;
            const feedback = [];

            if (password.length >= 8) strength += 1;
            else feedback.push('At least 8 characters');

            if (/[a-z]/.test(password)) strength += 1;
            else feedback.push('Lowercase letter');

            if (/[A-Z]/.test(password)) strength += 1;
            else feedback.push('Uppercase letter');

            if (/[0-9]/.test(password)) strength += 1;
            else feedback.push('Number');

            if (/[^A-Za-z0-9]/.test(password)) strength += 1;
            else feedback.push('Special character');

            return { strength, feedback };
        }

        // Update password strength display
        function updatePasswordStrength() {
            const password = password1.value;
            const result = checkPasswordStrength(password);
            const progressBar = passwordStrength.querySelector('.progress-bar');
            const strengthText = passwordStrength.querySelector('#strengthText');

            const percentage = (result.strength / 5) * 100;
            progressBar.style.width = percentage + '%';

            if (percentage <= 20) {
                progressBar.className = 'progress-bar bg-danger';
                strengthText.textContent = 'Very Weak';
            } else if (percentage <= 40) {
                progressBar.className = 'progress-bar bg-warning';
                strengthText.textContent = 'Weak';
            } else if (percentage <= 60) {
                progressBar.className = 'progress-bar bg-info';
                strengthText.textContent = 'Fair';
            } else if (percentage <= 80) {
                progressBar.className = 'progress-bar bg-primary';
                strengthText.textContent = 'Good';
            } else {
                progressBar.className = 'progress-bar bg-success';
                strengthText.textContent = 'Strong';
            }
        }

        // Check password match
        function checkPasswordMatch() {
            const match = password1.value === password2.value;
            const checkIcon = passwordMatch.querySelector('.fa-check-circle');
            const timesIcon = passwordMatch.querySelector('.fa-times-circle');
            const text = passwordMatch.querySelector('small');

            if (password1.value && password2.value) {
                if (match) {
                    checkIcon.style.display = 'inline';
                    timesIcon.style.display = 'none';
                    text.textContent = 'Passwords match!';
                    text.className = 'text-success';
                } else {
                    checkIcon.style.display = 'none';
                    timesIcon.style.display = 'inline';
                    text.textContent = 'Passwords do not match';
                    text.className = 'text-danger';
                }
            } else {
                checkIcon.style.display = 'none';
                timesIcon.style.display = 'none';
                text.textContent = 'Passwords must match';
                text.className = 'text-muted';
            }
        }

        // Event listeners
        password1.addEventListener('input', updatePasswordStrength);
        password1.addEventListener('input', checkPasswordMatch);
        password2.addEventListener('input', checkPasswordMatch);

        // Form validation
        form.addEventListener('submit', function(e) {
            if (!termsCheck.checked) {
                e.preventDefault();
                showToast('Please accept the terms and conditions', 'warning');
                termsCheck.focus();
                return;
            }

            if (password1.value !== password2.value) {
                e.preventDefault();
                showToast('Passwords do not match', 'danger');
                password2.focus();
                return;
            }

            // Show loading state
            submitBtn.innerHTML = '<span class="loading-spinner me-2"></span>Creating Account...';
            submitBtn.disabled = true;
        });

        // Real-time validation
        const inputs = form.querySelectorAll('input, select');
        inputs.forEach(input => {
            input.addEventListener('blur', function() {
                if (this.hasAttribute('required') && !this.value.trim()) {
                    this.classList.add('is-invalid');
                } else {
                    this.classList.remove('is-invalid');
                }
            });

            input.addEventListener('input', function() {
                if (this.classList.contains('is-invalid')) {
                    this.classList.remove('is-invalid');
                }
            });
        });
    });
</script>
{% endblock %}
